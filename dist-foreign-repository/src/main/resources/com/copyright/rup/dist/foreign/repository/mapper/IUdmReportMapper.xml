<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="IUdmReportMapper">
    <resultMap id="udmWeeklySurveyReportDtoResultMap" type="UdmWeeklySurveyReportDto">
        <result property="id" column="df_udm_usage_uid"/>
        <result property="period" column="period"/>
        <result property="dateReceived" column="date_received"/>
        <result property="channel" column="channel"/>
        <result property="usageOrigin" column="usage_origin"/>
        <result property="companyId" column="company_id"/>
        <result property="companyName" column="company_name"/>
        <result property="detailLicenseeClassId" column="detail_licensee_class_id"/>
        <result property="detailLicenseeClassName" column="detail_licensee_class_name"/>
        <result property="numberOfTotalRows" column="number_of_total_rows"/>
        <result property="numberOfUsableRows" column="number_of_usable_rows"/>
        <result property="percentUsable" column="percent_usable"/>
        <result property="numberOfRegisteredUsers" column="number_of_registered_users"/>
        <result property="numberOfRowsReportedByRegisteredUsers" column="number_of_rows_reported_by_registered_users"/>
        <result property="numberOfUsableRowsReportedByRegisteredUsers" column="number_of_usable_rows_reported_by_registered_users"/>
        <result property="percentUsableFromRegisteredUsers" column="percent_usable_from_registered_users"/>
        <result property="numberOfRowsReportedByUnregisteredUsers" column="number_of_rows_reported_by_unregistered_users"/>
        <result property="numberOfUsableRowsReportedByUnregisteredUsers" column="number_of_usable_rows_reported_by_unregistered_users"/>
        <result property="percentUsableFromUnregisteredUsers" column="percent_usable_from_unregistered_users"/>
    </resultMap>

    <select id="findUdmUsagesCountByFilter" parameterType="map" resultType="int">
        <include refid="IUdmUsageMapper.selectCountByFilterSql"/>
    </select>

    <select id="findUdmUsageDtosByFilter" resultMap="IUdmUsageMapper.udmUsageDtoResultMap" parameterType="map" fetchSize="${usageSelectFetchSize}">
        <include refid="IUdmUsageMapper.selectDtosByFilterSql"/>
    </select>

    <select id="findUdmBaselineUsagesCountByFilter" parameterType="map" resultType="int">
        <include refid="IUdmBaselineMapper.selectCountByFilterSql"/>
    </select>

    <select id="findUdmBaselineUsageDtosByFilter" resultMap="IUdmBaselineMapper.udmBaselineDtoResultMap" parameterType="map" fetchSize="${usageSelectFetchSize}">
        <include refid="IUdmBaselineMapper.selectDtosByFilterSql"/>
    </select>

    <select id="findUdmProxyValueDtosByFilter" resultMap="IUdmProxyValueMapper.udmProxyValueDtoResultMap" parameterType="map" fetchSize="${usageSelectFetchSize}">
        <include refid="IUdmProxyValueMapper.selectDtosByFilterSql"/>
    </select>

    <!-- TODO implement the MyBatis SELECT -->
    <select id="findUdmWeeklySurveyReportDtos" parameterType="map" resultMap="udmWeeklySurveyReportDtoResultMap">
        select
            df_udm_usage_uid,
            u.period,
            u.created_datetime as date_received,
            ub.channel,
            ub.usage_origin,
            company_id,
            company_name,
            u.detail_licensee_class_id,
            dlc.description detail_licensee_class_name,
            0 as number_of_total_rows,
            0 as number_of_usable_rows,
            0 as percent_usable,
            0 as number_of_registered_users,
            0 as number_of_rows_reported_by_registered_users,
            0 as number_of_usable_rows_reported_by_registered_users,
            0 as percent_usable_from_registered_users,
            0 as number_of_rows_reported_by_unregistered_users,
            0 as number_of_usable_rows_reported_by_unregistered_users,
            0 as percent_usable_from_unregistered_users
        from ${schema}.df_udm_usage u
        join ${schema}.df_udm_usage_batch ub on u.df_udm_usage_batch_uid = ub.df_udm_usage_batch_uid
        join ${schema}.df_detail_licensee_class dlc on u.detail_licensee_class_id = dlc.detail_licensee_class_id
        where u.created_datetime::date between #{dateReceivedFrom} and #{dateReceivedTo}
    </select>
</mapper>
