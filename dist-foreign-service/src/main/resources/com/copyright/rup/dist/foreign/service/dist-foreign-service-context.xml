<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="
            http://www.springframework.org/schema/beans
            http://www.springframework.org/schema/beans/spring-beans-4.1.xsd
            http://www.springframework.org/schema/context
            http://www.springframework.org/schema/context/spring-context-4.1.xsd
            http://www.springframework.org/schema/tx
            http://www.springframework.org/schema/tx/spring-tx-4.1.xsd">

    <import resource="classpath:/com/copyright/rup/dist/foreign/repository/dist-foreign-repository-context.xml" />
    <import resource="classpath:/com/copyright/rup/dist/foreign/integration/dist-foreign-integration-context.xml" />
    <import resource="classpath:/com/copyright/rup/dist/foreign/service/dist-foreign-performance-aspect-context.xml" />

    <!--Transaction manager configuration-->
    <tx:annotation-driven transaction-manager="txManager"/>

    <bean id="txManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
        <property name="dataSource" ref="dfDataSource"/>
    </bean>

    <context:component-scan base-package="com.copyright.rup.dist.foreign.service.impl"/>

    <bean id="quartzScheduler" class="org.springframework.scheduling.quartz.SchedulerFactoryBean">
        <property name="jobDetails">
            <list>
                <ref bean="df.service.rightsholdersQuartzJob"/>
                <ref bean="df.service.rightsAssignmentQuartzJob"/>
            </list>
        </property>
        <property name="triggers">
            <list>
                <ref bean="df.service.rightsholdersTrigger"/>
                <ref bean="df.service.rightsAssignmentTrigger"/>
            </list>
        </property>
        <property name="autoStartup" value="true"/>
    </bean>

    <bean id="df.service.rightsholdersQuartzJob" class="org.springframework.scheduling.quartz.JobDetailFactoryBean">
        <property name="jobClass" value="com.copyright.rup.dist.foreign.service.impl.quartz.RightsholdersQuartzJob"/>
        <property name="jobDataAsMap">
            <map>
                <entry key="rightsholderService" value-ref="rightsholderService"/>
            </map>
        </property>
        <property name="durability" value="true"/>
    </bean>

    <bean id="df.service.rightsAssignmentQuartzJob" class="org.springframework.scheduling.quartz.JobDetailFactoryBean">
        <property name="jobClass" value="com.copyright.rup.dist.foreign.service.impl.quartz.RightsAssignmentQuartzJob"/>
        <property name="jobDataAsMap">
            <map>
                <entry key="usageService" value-ref="usageService"/>
            </map>
        </property>
        <property name="durability" value="true"/>
    </bean>

    <bean id="df.service.rightsholdersTrigger" class="org.springframework.scheduling.quartz.CronTriggerFactoryBean">
        <property name="jobDetail" ref="df.service.rightsholdersQuartzJob"/>
        <property name="startDelay" value="10000"/>
        <property name="cronExpression" value="$RUP{dist.foreign.service.quartz.schedule.rightsholder}"/>
    </bean>

    <bean id="df.service.rightsAssignmentTrigger" class="org.springframework.scheduling.quartz.CronTriggerFactoryBean">
        <property name="jobDetail" ref="df.service.rightsAssignmentQuartzJob"/>
        <property name="startDelay" value="300000"/>
        <property name="cronExpression" value="$RUP{dist.foreign.service.quartz.schedule.send_for_ra}"/>
    </bean>
</beans>
